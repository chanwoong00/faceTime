version: '3.8'

services:
  # 1. MySQL 데이터베이스 서비스
  db:
    image: mysql:8.0
    container_name: facetime-db
    environment:
      MYSQL_ROOT_PASSWORD: 'your_root_password' # ⚠️ 보안을 위해 변경하세요
      MYSQL_DATABASE: 'facetime'                # ⚠️ DB 스키마 이름 (V1__Initial_Schema.sql 기준)
      MYSQL_USER: 'your_db_user'                # ⚠️ 사용할 DB 유저 이름
      MYSQL_PASSWORD: 'your_db_password'        # ⚠️ 사용할 DB 비밀번호
    ports:
      - "3306:3306" # 로컬에서 DB 접속 시
    volumes:
      - db-data:/var/lib/mysql

  # 2. 백엔드 (Spring Boot) 서비스
  backend:
    build: ./backend # 'backend' 폴더의 Dockerfile을 빌드
    container_name: facetime-backend
    depends_on:
      - db # DB가 먼저 실행되도록 보장
    ports:
      - "8081:8081" # 백엔드 8081 포트 노출
    environment:
      # application.properties의 변수들을 덮어씁니다.
      - DB_URL=jdbc:mysql://db:3306/facetime # 'db'는 위 DB 서비스 이름
      - DB_NAME=your_db_user                 # ⚠️ 위에서 설정한 DB 유저
      - DB_PW=your_db_password             # ⚠️ 위에서 설정한 DB 비밀번호
      - JWT_SE=your_secret_jwt_key_here  # ⚠️ application.properties의 JWT 비밀 키

  # 3. 프론트엔드 (React Native Web + Nginx) 서비스
  frontend:
    build: ./frontend # 'frontend' 폴더의 Dockerfile을 빌드
    container_name: facetime-frontend
    depends_on:
      - backend # 백엔드가 먼저 실행되도록 보장
    ports:
      - "80:80" # 사용자가 http://localhost 로 접속

volumes:
  db-data: # DB 데이터를 보존하기 위한 볼륨